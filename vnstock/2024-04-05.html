<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scatter Chart with Movement Indicators</title>
  <link rel="stylesheet" href="https://unpkg.com/vue-select@3.11.2/dist/vue-select.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-select@3.11.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
</head>
<body>

<div id="app">
  <v-select multiple :options="tagOptions" v-model="selectedTags" placeholder="Select tags"></v-select>
  <button @click="clearSelectedTags">Clear All</button>
  <p>Last updated: 2024-04-05T09:10:35.246Z</p>
  <canvas id="myScatterChart"></canvas>
</div>

<script>
  Vue.component('v-select', VueSelect.VueSelect);

  new Vue({
    el: '#app',
    data: {
      originalData: [{"name":"VCB","value":10.125397272580946,"change":0.7316720508953711},{"name":"VHM","value":0.07774405326234124,"change":0.24337154227412502},{"name":"BID","value":3.2242999770874836,"change":-2.3756835335161797},{"name":"VIC","value":22.812549928999246,"change":0.8996239306185068},{"name":"GAS","value":17.411386525184373,"change":-0.0031919030868223786},{"name":"ACV","value":8.709758961635622,"change":-1.9267593716110412},{"name":"HPG","value":5.9644618241071745,"change":-3.0066400195599217},{"name":"VNM","value":-18.489168542276964,"change":2.522672535507141},{"name":"VPB","value":4.560099701529906,"change":-0.37147823619902276},{"name":"CTG","value":1.1030665038242282,"change":-3.272319514260382},{"name":"MSN","value":5.358062347292432,"change":-2.1107142883639254},{"name":"TCB","value":38.997867028166205,"change":-2.728835384940723},{"name":"FPT","value":24.45225734346582,"change":-2.8955919162725827},{"name":"SAB","value":-16.197793061767634,"change":-0.19534837144800932},{"name":"MBB","value":13.45353706202238,"change":-4.252529265027675},{"name":"ACB","value":12.95184990358799,"change":-2.869871768243165},{"name":"GVR","value":30.144216511446842,"change":-3.447780698284852},{"name":"VGI","value":52.57504122195793,"change":4.496011626951834},{"name":"BCM","value":-3.2426951923777416,"change":-2.4838835040106777},{"name":"MWG","value":20.565754574335653,"change":-0.08090824223906878},{"name":"SSB","value":-40.372578096699286,"change":-1.0672790191686303},{"name":"VRE","value":2.209745208279879,"change":-1.5068290901630501},{"name":"BSR","value":4.576251815298256,"change":-0.7538298097188072},{"name":"MCH","value":24.46414431121288,"change":0.4315980546217588},{"name":"VJC","value":-7.608879068668297,"change":-0.11017921587392099}],
      selectedTags: JSON.parse(localStorage.getItem('selectedTags')) || [],
      myScatterChart: null
    },
    computed: {
      tagOptions() {
        return this.originalData.map(item => item.name);
      },
      filteredData() {
        return this.selectedTags.length > 0
               ? this.originalData.filter(item => this.selectedTags.includes(item.name))
               : this.originalData;
      }
    },
    methods: {
      createScatterData(data) {
        return {
          datasets: [
            {
              label: 'Symbol',
              data: data.map((item, index) => ({ x: index + 1, y: item.value })),
              backgroundColor: 'rgba(255, 99, 132, 1)',
              pointRadius: 6,
            },
            ...data.map((item, index) => ({
              data: [
                { x: index + 1, y: item.value - item.change },
                { x: index + 1, y: item.value }
              ],
              borderColor: item.change >= 0 ? 'green' : 'red',
              borderWidth: 2,
              showLine: true,
              fill: false,
              pointRadius: 0,
              tension: 0,
              borderDash: [5, 5]
            }))
          ]
        };
      },
      updateChart() {
        this.myScatterChart.data = this.createScatterData(this.filteredData);
        this.myScatterChart.update();
      },
      saveSelectedTags() {
        localStorage.setItem('selectedTags', JSON.stringify(this.selectedTags));
      },
      clearSelectedTags() {
        this.selectedTags = [];
      }
    },
    watch: {
      selectedTags: {
        handler() {
          this.updateChart();
          this.saveSelectedTags();
        },
        deep: true
      }
    },
    mounted() {
      const ctx = document.getElementById('myScatterChart').getContext('2d');
      const config = {
        type: 'scatter',
        data: this.createScatterData(this.filteredData),
        options: {
          layout: {
            padding: 100
          },
          scales: {
            x: {
              type: 'linear',
              position: 'bottom'
            },
            y: {
              type: 'linear',
              position: 'left'
            }
          },
          plugins: {
            title: {
              display: true,
              text: 'Biểu đồ RSI'
            },
            legend: {
              display: false
            },
            datalabels: {
              anchor: 'end',
              align: 'top',
              offset: 5,
              formatter: function(value, context) {
                const dataIndex = context.dataIndex;
                if (context.datasetIndex === 0 && dataIndex < this.filteredData.length) {
                  return this.filteredData[dataIndex].name + " " + this.filteredData[dataIndex].value;
                } else {
                  return null;
                }
              }.bind(this),
              color: '#444',
              font: {
                weight: 'bold'
              }
            }
          }
        },
        plugins: [ChartDataLabels]
      };
      this.myScatterChart = new Chart(ctx, config);
    }
  });
</script>
</body>
</html>
